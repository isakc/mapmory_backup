<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">	
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
</style>
</head>

<body>
<footer th:fragment="defaultFooter" class="footer-container">
 <!--	<table>
		<tbody>
			<tr>
				<td><img class="footerImage" th:name="타임라인" th:src="'https://bcuacdphgdfn24694507.cdn.ntruss.com/timelineList-free-icon-open-book-1375505.png'"/></td>
				<td><img class="footerImage" th:name="체크포인트" th:src="'https://bcuacdphgdfn24694507.cdn.ntruss.com/checkpoint_image.png'" /></td>
				<td><img class="footerImage" th:name="체크포인트" th:src="'https://bcuacdphgdfn24694507.cdn.ntruss.com/checkpoint_image.png'" /></td>
				<td><img class="footerImage" th:name="체크포인트" th:src="'https://bcuacdphgdfn24694507.cdn.ntruss.com/checkpoint_image.png'" /></td>
				<td><img class="footerImage" th:name="체크포인트" th:src="'https://bcuacdphgdfn24694507.cdn.ntruss.com/checkpoint_image.png'" /></td>
			</tr>
		</tbody>
	</table>
 -->

	<nav class="mobile-bottom-nav">
		<!-- <div class="mobile-bottom-nav__item mobile-bottom-nav__item--active"> -->
		<div class="mobile-bottom-nav__item" >
		    <div class="mobile-bottom-nav__item-content" th:classappend="${#request.requestURI.contains('/user/') && !#request.requestURI.contains('/user/getPersonalSecurityMenu') ? 'mobile-bottom-nav__item--active' : ''}" name="프로필">
		        <i class="material-icons footer-material-icons notranslate" th:text="'account_box'"></i>
		        <span th:text="'Profile'"></span>
		    </div>        
		</div>

		<div class="mobile-bottom-nav__item " >
			<div class="mobile-bottom-nav__item-content" th:classappend="${#request.requestURI.contains('/timeline/') ? 'mobile-bottom-nav__item--active' : ''}" name="타임라인">
				<i class="material-icons footer-material-icons notranslate" th:text="'library_books'"></i>
		        <span th:text="'TimeLine'"></span>
			</div>
		</div>
		
		<th:block th:if="${#request.requestURI.contains('/map')}">
			<div class="mobile-bottom-nav__item" >
				<div class="mobile-bottom-nav__item-content" name="체크포인트">
					<i class="material-icons footer-material-icons notranslate" th:text="'album'"></i>
		        <span th:text="'Checkpoint'"></span>
				</div>		
			</div>
		</th:block>

		<th:block th:if="!${#request.requestURI.contains('/map')}">
			<div class="mobile-bottom-nav__item" >
				<div class="mobile-bottom-nav__item-content"  name="맵">
					<i class="material-icons footer-material-icons notranslate" th:text="'map'"></i>
		        <span th:text="'Map'"></span>
				</div>		
			</div>
		</th:block>
		
		
		<div class="mobile-bottom-nav__item " >
			<div class="mobile-bottom-nav__item-content" th:classappend="${#request.requestURI.contains('/community/') ? 'mobile-bottom-nav__item--active' : ''}" name="커뮤니티">
				<svg xmlns="http://www.w3.org/2000/svg" width="5vh" height="5vh" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16" >
				  <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4"/>
				</svg>
		        <span th:text="'Community'"></span>
			</div>		
		</div>
		<div class="mobile-bottom-nav__item " >
			<div class="mobile-bottom-nav__item-content"  th:classappend="${#request.requestURI.contains('/common/menu') || #request.requestURI.contains('/user/getPersonalSecurityMenu') ? 'mobile-bottom-nav__item--active' : ''}" name="메뉴">
				<i class="material-icons footer-material-icons notranslate" th:text="'list'"></i>
		        <span th:text="'Menu'"></span>
			</div>		
		</div>
	</nav> 
	
	
	
<div th:include="timeline/component/modal::defaultModal"></div>
<div th:include="timeline/component/modal::checkpointModal"></div>
<input type="hidden" th:name="recordUserIdOfFooter" th:value="${userId}"/>
<input type="hidden" th:name="latitudeOfFooter" th:value="'37.4923615'"/>
<input type="hidden" th:name="longitudeOfFooter" th:value="'127.0292881'"/>
<input type="hidden" th:name="checkpointAddressOfFooter" th:value="'서울시 강남구'"/>

	
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>	
<script type="text/javascript" th:src="@{//dapi.kakao.com/v2/maps/sdk.js(appkey=${apiKey})}"></script>
<script type="text/javascript">
$(function() {
		
	let userId = sessionStorage.getItem("userId");

	$("div[name='타임라인']").on("click", function() {
		self.location = '/timeline/getTimelineList';
	});
	
	$("div[name='체크포인트']").on("click", function() {
		
		if (navigator.geolocation) {
		    
		    // GeoLocation을 이용해서 접속 위치를 얻어옵니다
		    navigator.geolocation.getCurrentPosition(function(position) {
		        
		    	var latFooter = position.coords.latitude; // 위도
		    	var lonFooter = position.coords.longitude; // 경도
		        console.log(latFooter);
		        console.log(lonFooter);
		    	$('input[name="latitudeOfFooter"]').val(latFooter).trigger('change');
		        $('input[name="longitudeOfFooter"]').val(lonFooter);
		      });
		    
		} else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다
			let message = 'geolocation을 사용할수 없어요..'
			showModal('위치 추적 오류',message);
			//alert(message);
		}
	})//$("img[name='체크포인트']").on("click", function() { 끝
		
	$('input[name="latitudeOfFooter"]').on("change",function(){
		let latitudeFooter = $('input[name="latitudeOfFooter"]').val();
		let longitudeFooter = $('input[name="longitudeOfFooter"]').val();
		$.ajax("https://dapi.kakao.com/v2/local/geo/coord2address.json",{
			method : "GET",
			dataType : "json",
			headers : {
				"Authorization" : "KakaoAK [[${restKey}]]",
				"Content-type" : "application/json;charset=UTF-8"
			},
			data : {
				x : longitudeFooter,
				y : latitudeFooter
			},
			success : function(response,status){
				//console.log(response.documents[0].road_address);
				//console.log(response.documents[0].address.address_name);
		    	$('input[name="checkpointAddressOfFooter"]')
		    	.val(response.documents[0].road_address!==null ? response.documents[0].road_address.address_name:response.documents[0].address.address_name)
		    	.trigger('change');
			},
            error: function(xhr, status, error) {
                alert('Error: ' + error);
            }
			
			})
		})//$('input[name="latitudeOfFooter"]').on("change",function(){ 끝
		
		$('input[name="checkpointAddressOfFooter"]').on("change",function(){
			let recordUserId = $('input[name="recordUserIdOfFooter"]').val();
			let latitudeFooter = $('input[name="latitudeOfFooter"]').val();
			let longitudeFooter = $('input[name="longitudeOfFooter"]').val();
			let checkpointAddress = $('input[name="checkpointAddressOfFooter"]').val();
			$.ajax("/timeline/rest/addTimeline",{
				method : "POST",
				dataType : "json",
				headers : {
					"Content-Type" : "application/json; charset = UTF-8",
					"Accept" : "application/json; charset = UTF-8"
				},
				data : JSON.stringify({
		  		  	recordUserId : recordUserId,
		    		latitude : latitudeFooter,
		    		longitude : longitudeFooter,
		    		checkpointAddress : checkpointAddress
				}),
				success : function(response,status){
					
					console.log(JSON.stringify(response));
					checkpointShowModal('체크포인트',response.text);
					
					$('#checkpointModalCheck').on("click",function(){
						let uri="?recordNo="+response.recordNo;
						self.location="/timeline/updateTimeline"+uri;
					})
					
				},
        		error: function(xhr, status, error) {
            		alert('Error: ' + error);
        		}

			})
		})//$('input[name="checkpointAddressOfFooter"]').on("change",function(){ 끝
		
		$("div[name='프로필']").on("click", function() {
			window.location.href=`/user/getProfile?userId=${userId}`;
		});
		
		$("div[name='커뮤니티']").on("click", function() {
			window.location.href="/community/getSharedRecordList";
		});
		
		$("div[name='메뉴']").on("click", function() {
			window.location.href="/common/menu";
		});
		
		$("div[name='맵']").on("click", function() {
			window.location.href="/map"
		});
		
		
		$('<link>')
     .appendTo('head')
     .attr({
       type: 'text/css',
       rel: 'stylesheet',
       href: '/css/common/footer.css'
    });	
	});
</script>
</footer>	
</body>

</html>
